//===== eAthena Script =======================================
//= 第二期攻城戰
//===== By: ==================================================
//= L0ne_W0lf
//===== Current Version: =====================================
//= 2.0
//===== Compatible With: =====================================
//= eAthena SVN
//===== Description: =========================================
//= WoE SE 秀發茲發德 教國 Castle 1 (喜民)
//============================================================

schg_cas01,1,1,0	script	Manager#sch01_02	111,{
	end;

OnInterIfInitOnce:
	GetCastleData "schg_cas01",0,"::OnRecvCastleSc01";
	end;

OnRecvCastleSc01:
	RequestGuildInfo GetCastleData("schg_cas01",1);
	if (GetCastleData("schg_cas01",1) == 0) {
		donpcevent "Manager#sch01_02::Onstart";
	}
	end;

OnAgitStart2:
	if (agitcheck2()) {
		MapRespawnGuildID "schg_cas01",GetCastleData("schg_cas01",1),2;
		GvgOn "schg_cas01";
		donpcevent "Manager#sch01_02::Onstart";
	}
	else {
		donpcevent "#sch01_RL00::OnDisable";
		donpcevent "#sch01_RL01::OnDisable";
		donpcevent "#sch01_RL02::OnDisable";
		donpcevent "#sch01_RL03::OnDisable";
	}
	end;

OnAgitEnd2:
	GvgOff "schg_cas01";
	if (GetCastleData("schg_cas01",1)) {
		KillMonster "schg_cas01","管理人#sch01::OnStartArena";
		donpcevent "Manager#sch01_02::Onreset";
		donpcevent "管理人#sch01::Onstop";
	}
	end;

Onstart:
	// 第1守護石, 第2守護石, 第1防禦線, 第2防禦線, 第3防禦線, 召喚監護人魔物
	// Settings for all but Summon Guardians
	// 0 = Okay; 1 = Destroyed; 2 = Repairing
	// 召喚監護人魔物
	// 0 = 不召喚; 1 = 召喚
	if (GetCastleData("schg_cas01",1)) {
		setarray $agit_sc01[0],0,0,0,0,0,0;
		donpcevent "#sch01_df01::OnEnable";
		donpcevent "#sch01_df02::OnEnable";
		donpcevent "#sch01_RL00::OnEnable";
		donpcevent "#sch01_RL01::OnEnable";
		donpcevent "#sch01_RL02::OnEnable";
		donpcevent "#sch01_RL03::OnEnable";
	}
	monster "schg_cas01",120,272,"華麗金屬",1288,1,"管理人#sch01::OnStartArena";
	end;

Onreset:
	donpcevent "#sch01_df01::OnDisable";
	donpcevent "#sch01_df02::OnDisable";
	donpcevent "#sch01_gard01::Onreset";
	donpcevent "#sch01_gard02::Onreset";
	donpcevent "#sch01_RL00::OnDisable";
	donpcevent "#sch01_RL01::OnDisable";
	donpcevent "#sch01_RL02::OnDisable";
	donpcevent "#sch01_RL03::OnDisable";
	donpcevent "第1守護石#sch01::OnDisable";
	donpcevent "第2守護石#sch01::OnDisable";
	donpcevent "控制裝置01#sch01::OnDisable";
	donpcevent "控制裝置02#sch01::OnDisable";
	donpcevent "控制裝置03#sch01::OnDisable";
	if (agitcheck2()) {
		setarray $agit_sc01[0],0,0,1,1,1,0;
	}
	end;

Onchange:
	setarray $agit_sc01[0],2,2,1,1,2,0;
	monster "schg_cas01",120,272,"華麗金屬",1288,1,"管理人#sch01::OnStartArena";
	donpcevent "控制裝置03#sch01::OnEnable";
	donpcevent "第1守護石#sch01::OnEnable";
	donpcevent "第2守護石#sch01::OnEnable";
	end;

OnClock0001:
	if (!GetCastleData("schg_cas01",1)) end;
	killmonster "schg_cas01","Manager#sch01_02::OnTreasureDied";

	if (GetCastleData("schg_cas01",4)) {
		set .@Economy,GetCastleData("schg_cas01",2);
		SetCastleData "schg_cas01",2,.@Economy + GetCastleData("schg_cas01",4) + (rand(2) && getgdskilllv(.@GID,10014));
		if (GetCastleData("schg_cas01",2) > 100) SetCastleData "schg_cas01",2,100;
		setcastledata "schg_cas01",4,0;
	}
	if (GetCastleData("schg_cas01",5)) {
		set .@Defence,GetCastleData("schg_cas01",3);
		SetCastleData "schg_cas01",3,.@Defence + GetCastleData("schg_cas01",5);
		if (GetCastleData("schg_cas01",3) > 100) SetCastleData "schg_cas01",3,100;
		setcastledata "schg_cas01",5,0;
	}

	set .@Treasure,GetCastleData("schg_cas01",2)/5+4;
	if (.@Treasure) {
		monster "schg_cas01",388,388,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		monster "schg_cas01",388,389,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		monster "schg_cas01",388,390,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		monster "schg_cas01",387,390,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 5) end;
		monster "schg_cas01",386,390,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 6) end;
		monster "schg_cas01",385,390,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 7) end;
		monster "schg_cas01",384,389,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 8) end;
		monster "schg_cas01",384,388,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 9) end;
		monster "schg_cas01",384,387,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 10) end;
		monster "schg_cas01",384,386,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 11) end;
		monster "schg_cas01",384,385,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 12) end;
		monster "schg_cas01",384,384,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 13) end;
		monster "schg_cas01",385,384,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 14) end;
		monster "schg_cas01",386,384,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 15) end;
		monster "schg_cas01",387,384,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 16) end;
		monster "schg_cas01",388,384,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 17) end;
		monster "schg_cas01",389,384,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 18) end;
		monster "schg_cas01",390,384,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 19) end;
		monster "schg_cas01",390,385,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 20) end;
		monster "schg_cas01",390,386,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 21) end;
		monster "schg_cas01",389,386,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 22) end;
		monster "schg_cas01",388,386,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 23) end;
		monster "schg_cas01",387,386,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
		if (.@Treasure < 24) end;
		monster "schg_cas01",386,386,"寶物箱子",1938,1,"Manager#sch01_02::OnTreasureDied";
	}
	end;

OnTreasureDied:
	end;
}

schg_cas01,123,306,3	script	伊僕#sch01_01	868,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (.@GID == 0) {
		mes "[伊僕]";
		mes "何許人物?";
		mes "請你快一點離開這座城池吧!";
		close;
	}
	if (getcharid(2) == .@GID) {
		if (strcharinfo(0) != getguildmaster(.@GID)) {
			mes "[伊僕]";
			mes "我是負責城池的守護,";
			mes "詳細的內容我想跟主人說";
			close;
		}
		else {
			if (agitcheck2() == 0) {
				mes "[伊僕]";
				mes "我是這座城的監護人";
				mes "這個據點,現在";
				mes "一切都很平靜";
				next;
				switch(select("交談:取消")) {
				case 1:
					mes "[伊僕]";
					mes "你有什麼問題";
					mes "有關於這據點的問題?";
					next;
					switch(select("守護石:防禦線:空間移動系統:戰略資訊:取消")) {
					case 1:
						mes "[伊僕]";
						mes "有一 Emperium";
						mes "每一座城堡";
						mes "都會有二個守護石";
						mes "每個城堡的守護石";
						mes "是第一道防線,";
						mes "在他尚未銷毀之前";
						mes "敵人是無法進入到城堡內部的.";
						next;
						mes "[伊僕]";
						mes "守護石位於";
						mes "^4D4DFF據點中^000000";
						mes "你需要防守這邊,";
						mes "以防止敵人破壞他.";
						mes "守護石^4D4DFF可以經由傳送到達";
						mes "你的守護者^000000會保護他.";
						next;
						mes "[伊僕]";
						mes "城堡具有較高防禦度";
						mes "可以召喚更多的防守護人";
						mes "這就是為什麼它是";
						mes "此重要的投資";
						mes "防禦度可以經由投資增加.";
						next;
						mes "[伊僕]";
						mes "守護石";
						mes "可以恢復以及被破壞";
						mes "經過一定時間以後,";
						mes "工會成員可以修復.";
						close;
					case 2:
						mes "[伊僕]";
						mes "^4D4DFF防禦線^000000^FFFFFF是第二個 ^000000公會需要防禦的據點,";
						mes "玩家可以在防禦線後方狙擊敵人.";
						mes "這些防禦線設在三個不同地區的入口.";
						next;
						mes "[伊僕]";
						mes "防禦線受到守護石的保護";
						mes "當守護石恢復時將會是監護人重生";
						mes "但是守護石不是那麼容易恢復";
						mes "必須由公會成員使用適當材料來修復,";
						close;
					case 3:
						mes "[伊僕]";
						mes "各個據點";
						mes "都可以經由旗幟自由的傳送";
						mes "進入防守的區域中";
						mes "限制條件:";
						mes "每次傳送都有^4D4DFFF延遲時間";
						mes "等延遲時間過後才可以在傳送到其他據點^000000.";
						close;
					case 4:
						mes "[伊僕]";
						mes "戰略? 不如";
						mes "發展你的作戰計劃";
						mes "利用你的公會的優勢";
						mes "和你的敵人對決.";
						mes "使用防護線和路障有效的狙擊敵人!";
						close;
					case 5:
						mes "[伊僕]";
						mes "[艾迪僕]";
						mes "您沒有任何問題";
						mes "要問我嗎？";
						mes "我會滿足您的需求.";
						close;
					}
				case 2:
					mes "[伊僕]";
					mes "我一直在這裡，所以";
					mes "當你需要幫忙時";
					mes "隨時可以來找我";
					close;
				}
			}
			else {
				mes "[伊僕]";
				mes "您好, "+strcharinfo(0)+".";
				mes "你想選擇什麼?";
				next;
				switch(select("增加城堡防禦:檢查防禦狀態:取消")) {
				case 1:
					if ($agit_sc01[5] == 0) {
						if (getgdskilllv(.@GID,10002) == 0) {
							mes "[伊僕]";
							mes "我很抱歉";
							mes "守護石目前還不夠強大";
							mes "無法在召喚守護者呢";
							mes "需要積累更多";
							mes "防禦度才能";
							mes "招喚更多的守護者.";
							close;
						}
						else {
							mes "[伊僕]";
							mes "我將努力召集";
							mes "更多的守護者";
							mes "不過，請記住";
							mes "如果守護石被破壞";
							mes "將會使得守護者減少.";
							setarray $agit_sc01[5],1;
							if ($agit_sc01[0] == 0) {
								donpcevent "#sch01_gard01::OnEnable";
							}
							if ($agit_sc01[1] == 0) {
								donpcevent "#sch01_gard02::OnEnable";
							}
							close;
						}
					}
					else {
						mes "[伊僕]";
						mes "您已經吩咐";
						mes "我召喚守護者";
						mes "保衛堡壘.";
						close;
					}
				case 2:
					mes "[伊僕]";
					mes "我們的防禦狀態是...";
					if ($agit_sc01[0] == 1) {
						mes "第1守護石: ^FF0000被破壞^000000";
					}
					else if ($agit_sc01[0] == 2) {
						mes "第1守護石: ^008000修復中^000000";
					}
					else {
						mes "第1守護石: ^4D4DFF正常^000000";
					}
					if ($agit_sc01[1] == 1) {
						mes "第2守護石: ^FF0000被破壞^000000";
					}
					else if ($agit_sc01[1] == 2) {
						mes "第2守護石: ^008000修復中^000000";
					}
					else {
						mes "第2守護石: ^4D4DFF正常^000000";
					}
					if ($agit_sc01[2] == 1) {
						mes "第1防禦線: ^FF0000被破壞^000000";
					}
					else if ($agit_sc01[2] == 2) {
						mes "第1防禦線: ^008000修復中^000000";
					}
					else {
						mes "第1防禦線: ^4D4DFF正常^000000";
					}
					if ($agit_sc01[3] == 1) {
						mes "第2防禦線: ^FF0000被破壞^000000";
					}
					else if ($agit_sc01[3] == 2) {
						mes "第2防禦線: ^008000修復中^000000";
					}
					else {
						mes "第2防禦線: ^4D4DFF正常^000000";
					}
					if ($agit_sc01[4] == 1) {
						mes "第3防禦線: ^FF0000被破壞^000000";
					}
					else if ($agit_sc01[4] == 2) {
						mes "第3防禦線: ^008000修復中^000000";
					}
					else {
						mes "第3防禦線: ^4D4DFF正常^000000";
					}
					close;
				case 3:
					mes "[伊僕]";
					mes "我隨時在此,";
					mes "等候您的指示";
					close;
				}
			}
		}
	}
	else {
		mes "[伊僕]";
		mes "何許人物?";
		mes "請你快一點離開這座城池吧!";
		close;
	}

OnInit:
	setarray $agit_sc01[0],0,0,0,0,0,0;
	end;
}

schg_cas01,1,1,0	script	#sch01_gard01	-1,{
OnEnable:
	set .@Defence,GetCastleData("schg_cas01",3);
	guardian "schg_cas01",111,18,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //0;
	if ((.@Defense > 10) && (.@Defense < 31)) {
		set .MyMobCount,2;
		guardian "schg_cas01",109,44,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //1;
	}
	else if ((.@Defense > 30) && (.@Defense < 51)) {
		set .MyMobCount,3;
		guardian "schg_cas01",109,44,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //1;
		guardian "schg_cas01",65,22,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //2;
	}
	else if ((.@Defense > 50) && (.@Defense < 71)) {
		set .MyMobCount,4;
		guardian "schg_cas01",109,44,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //1;
		guardian "schg_cas01",65,22,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //2;
		guardian "schg_cas01",110,40,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //3;
	}
	else if (.@Defense > 70) {
		set .MyMobCount,5;
		guardian "schg_cas01",109,44,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //1;
		guardian "schg_cas01",65,22,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //2;
		guardian "schg_cas01",110,40,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //3;
		guardian "schg_cas01",88,20,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //4;
	}
	else {
		set .MyMobCount,2;
		guardian "schg_cas01",108,32,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //1;
	}
	initnpctimer;
	end;

OnTimer300000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",64,40,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //5;
	mapannounce "schg_cas01","在據點那裡 第1次追加的召喚出監護人魔物了",bc_map,"0xff4500";
	end;

OnTimer900000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",47,43,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //6;
	mapannounce "schg_cas01","在據點那裡 第2次追加的召喚出監護人魔物了",bc_map,"0xff4500";
	end;

OnTimer1800000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",109,48,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //7;
	mapannounce "schg_cas01","在據點那裡 第3次追加的召喚出監護人魔物了",bc_map,"0xff4500";
	end;

OnTimer2700000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",111,18,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //8;
	mapannounce "schg_cas01","在據點那裡 第4次追加的召喚出監護人魔物了",bc_map,"0xff4500";
	end;

OnTimer3600000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",112,32,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //9;
	mapannounce "schg_cas01","在據點那裡 第5次追加的召喚出監護人魔物了",bc_map,"0xff4500";
	stopnpctimer;
	end;

OnGuardianDied:
	set .MyMobCount,.MyMobCount-1;
	if (.MyMobCount < 2) {
		set .MyMobCount,.MyMobCount+1;
		guardian "schg_cas01",120,37,"劍士監護人魔物",1899,"#sch01_gard01::OnGuardianDied"; //10;
	}
	end;

Onreset:
	stopnpctimer;
	killmonster "schg_cas01","#sch01_gard01::OnGuardianDied";
	end;
}

schg_cas01,1,2,0	script	#sch01_gard02	-1,{
OnEnable:
	set .@Defence,GetCastleData("schg_cas01",3);
	guardian "schg_cas01",130,22,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //11;
	if ((.@Defense > 10) && (.@Defense < 31)) {
		set .MyMobCount,2;
		guardian "schg_cas01",187,15,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //12;
	}
	else if ((.@Defense > 30) && (.@Defense < 51)) {
		set .MyMobCount,3;
		guardian "schg_cas01",129,47,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //12;
		guardian "schg_cas01",151,18,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //13;
	}
	else if ((.@Defense > 50) && (.@Defense < 71)) {
		set .MyMobCount,4;
		guardian "schg_cas01",129,47,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //12;
		guardian "schg_cas01",151,18,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //13;
		guardian "schg_cas01",187,15,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //14;
	}
	else if (.@Defense > 70) {
		set .MyMobCount,5;
		guardian "schg_cas01",129,47,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //12;
		guardian "schg_cas01",151,18,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //13;
		guardian "schg_cas01",187,15,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //14;
		guardian "schg_cas01",128,42,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //15;
	}
	else {
		set .MyMobCount,2;
		guardian "schg_cas01",128,42,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //12;
	}
	initnpctimer;
	end;

OnTimer600000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",152,43,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //16;
	end;

OnTimer1200000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",187,15,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //17;
	end;

OnTimer2100000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",128,42,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //18;
	end;

OnTimer3000000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",130,22,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //19;
	end;

OnTimer3900000:
	set .MyMobCount,.MyMobCount+1;
	guardian "schg_cas01",130,28,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //20;
	stopnpctimer;
	end;

OnGuardianDied:
	set .MyMobCount,.MyMobCount-1;
	if (.MyMobCount < 2) {
		set .MyMobCount,.MyMobCount+1;
		guardian "schg_cas01",151,18,"劍士監護人魔物",1899,"#sch01_gard02::OnGuardianDied"; //21;
	}
	end;

Onreset:
	stopnpctimer;
	killmonster "schg_cas01","#sch01_gard02::OnGuardianDied";
	end;
}

schg_cas01,1,3,0	script	#sch01_df01	-1,{
OnEnable:
	guardian "schg_cas01",27,35,"第 1 守護石",1907,"#sch01_df01::OnGuardianStoneDied"; //22;
	end;

OnDisable:
	killmonster "schg_cas01","#sch01_df01::OnGuardianStoneDied";
	setarray $agit_sc01[0],1; //Global Variable
	stopnpctimer;
	end;

OnGuardianStoneDied:
	// 1st Guardian Stone is Destroyed
	setarray $agit_sc01[0],1;
	if (($agit_sc01[0] == 1) || ($agit_sc01[0] == 2)) {
		set .@destroyed,.@destroyed + 1;
	}
	if (($agit_sc01[1] == 1) || ($agit_sc01[1] == 2)) {
		set .@destroyed,.@destroyed + 1;
	}
	if (.@destroyed == 2) {
		mapannounce "schg_cas01","守護石全部 都被破壞掉了!",bc_map,"0x00ff00";
		donpcevent "#sch01_RL00::OnDisable";
		donpcevent "#sch01_gard01::Onreset";
	}
	else {
		mapannounce "schg_cas01","第1守護石 被破壞掉了!",bc_map,"0x00ff00";
		donpcevent "#sch01_gard01::Onreset";
	}
	initnpctimer;
	end;

OnTimer300000:
	donpcevent "第1守護石#sch01::OnEnable";
	setarray $agit_sc01[0],2; //Global Variable
	stopnpctimer;
	end;
}

schg_cas01,27,36,0	script	第1守護石#sch01	844,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "把破壞掉的守護石要重新形成了,";
		mes "請問要繼續的進行作業嗎?";
		switch(select("結束:進行")) {
		case 1:
			mes "所有的作業都被取消了";
			close;
		case 2:
			//if ((countitem(984) > 0) && (countitem(985) > 0) && (countitem(7049) > 29) && (countitem(717) > 4) && (countitem(715) > 4) && (countitem(716) > 4)) {
				mes "中央要依據";
				mes "石頭,鋁,神之金屬的順序來配置,";
				mes "為了要重新形成";
				mes "要配置有魔力的魔力礦石";
				next;
				switch(select("鋁:神之金屬:石頭")) {
				case 1:
					mes "在中央放上鋁";
					next;
					break;
				case 2:
					mes "在中央放上神之金屬";
					next;
					break;
				case 3:
					mes "在中央放上石頭";
					set .@nice,.@nice+10;
					next;
					break;
				}
				switch(select("鋁:神之金屬:石頭")) {
				case 1:
					mes "配置鋁";
					set .@nice,.@nice+10;
					next;
					break;
				case 2:
					mes "配置神之金屬";
					next;
					break;
				case 3:
					mes "配置石頭";
					next;
					break;
				}
				switch(select("鋁:神之金屬:石頭")) {
				case 1:
					mes "把鋁放在最上位";
					next;
					break;
				case 2:
					mes "把神之金屬放在最上位";
					set .@nice,.@nice+10;
					next;
					break;
				case 3:
					mes "把石頭放在最上位";
					next;
					break;
				}
				mes "不違背魔法式";
				mes "要配置有魔力的魔力礦石,";
				mes "魔力的性質用準備的效果以便可得知";
				next;
				while(1) {
					if (.@roof0 > 7) {
						break;
					}
					else {
						switch(rand(1,3)) {
						case 1:
							specialeffect EF_BEGINSPELL2;
							mes "請配置跟魔力一樣的魔法式";
							mes "魔力礦石吧";
							next;
							switch(select("紅色魔力礦石:黃色魔力礦石:藍色魔力礦石")) {
							case 1:
								mes "配置紅色魔力礦石了";
								close;
							case 2:
								mes "配置黃色魔力礦石了,";
								close;
							case 3:
								mes "配置藍色魔力礦石了,";
								set .@nice,.@nice+10;
								set .@roof0,.@roof0 + 1;
								specialeffect EF_STEAL;
								next;
								break;
							}
							break;
						case 2:
							specialeffect EF_VOLCANO;
							mes "請配置跟魔力一樣的魔法式";
							mes "魔力礦石吧";
							next;
							switch(select("紅色魔力礦石:黃色魔力礦石:藍色魔力礦石")) {
							case 1:
								mes "配置紅色魔力礦石了";
								set .@nice,.@nice+10;
								set .@roof0,.@roof0 + 1;
								specialeffect EF_STEAL;
								next;
								break;
							case 2:
								mes "配置黃色魔力礦石了,";
								close;
							case 3:
								mes "配置藍色魔力礦石了,";
								close;
							}
							break;
						case 3:
							specialeffect EF_BEGINSPELL4;
							mes "請配置跟魔力一樣的魔法式";
							mes "魔力礦石吧";
							next;
							switch(select("紅色魔力礦石:黃色魔力礦石:藍色魔力礦石")) {
							case 1:
								mes "配置紅色魔力礦石了";
								close;
							case 2:
								mes "配置黃色魔力礦石了,";
								set .@nice,.@nice+10;
								set .@roof0,.@roof0 + 1;
								specialeffect EF_STEAL;
								next;
								break;
							case 3:
								mes "配置藍色魔力礦石了,";
								close;
							}
						}
					}
				}
				if (.@nice > 90) {
					if ($agit_sc01[0] == 0) {
						mes "守護石重新的形成已經被完成了";
						close;
					}
					else {
						if (agitcheck2() == 0) {
							mes "因魔力互相的衝突";
							mes "對守護石重新的形成失敗了";
							close;
						}
						else {
							mes "已完成了魔力礦石的配置,";
							mes "守護石的重新形成是成功的!!!";
							close2;
							donpcevent "#sch01_df01::OnEnable";
							specialeffect EF_ICECRASH;
							disablenpc "第1守護石#sch01";
							setarray $agit_sc01[0],0;
							set .@df_all,$agit_sc01[0]+$agit_sc01[1];
							if (.@df_all == 0) {
								mapannounce "schg_cas01","守護石已完全的修復 開始強化警戒了",bc_map,"0x00ff00";
								donpcevent "#sch01_RL00::OnEnable";
							}
							else {
								mapannounce "schg_cas01","第1守護石重新形成 已成功了!",bc_map,"0x00ff00";
							}
							if ($agit_sc01[5] == 1) {
								donpcevent "#sch01_gard01::OnEnable";
							}
							end;
						}
					}
				}
				else {
					mes "所有的作業都做完後.. 碰咚碰咚的響著";
					mes "沒有任何的反應";
					mes "看樣子是失敗的樣子,";
					close;
				}
		}
	}
	end;

OnInit:
	disablenpc "第1守護石#sch01";
	end;

OnEnable:
	enablenpc "第1守護石#sch01";
	specialeffect EF_MAPPILLAR2;
	end;

OnDisable:
	disablenpc "第1守護石#sch01";
	end;
}

schg_cas01,1,4,0	script	#sch01_df02	-1,{
OnEnable:
	guardian "schg_cas01",207,75,"第 2 守護石",1908,"#sch01_df02::OnGuardianStoneDied"; //23;
	end;

OnDisable:
	killmonster "schg_cas01","#sch01_df02::OnGuardianStoneDied";
	setarray $agit_sc01[1],1; //Global Variable
	stopnpctimer;
	end;

OnGuardianStoneDied:
	// 2nd Guardian Stone is Destroyed
	setarray $agit_sc01[1],1;
	if (($agit_sc01[0] == 1) || ($agit_sc01[0] == 2)) {
		set .@destroyed,.@destroyed + 1;
	}
	if (($agit_sc01[1] == 1) || ($agit_sc01[1] == 2)) {
		set .@destroyed,.@destroyed + 1;
	}
	if (.@destroyed == 2) {
		mapannounce "schg_cas01","守護石全部 都被破壞掉了!",bc_map,"0x00ff00";
		donpcevent "#sch01_RL00::OnDisable";
		donpcevent "#sch01_gard02::Onreset";
	}
	else {
		mapannounce "schg_cas01","第2守護石 被破壞掉了!",bc_map,"0x00ff00";
		donpcevent "#sch01_gard02::Onreset";
	}
	initnpctimer;
	end;

OnTimer300000:
	donpcevent "第2守護石#sch01::OnEnable";
	setarray $agit_sc01[1],2; //Global Variable
	stopnpctimer;
	end;
}

schg_cas01,208,75,0	script	第2守護石#sch01	844,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "把破壞掉的守護石要重新形成了,";
		mes "請問要繼續的進行作業嗎?";
		switch(select("結束:進行")) {
		case 1:
			mes "所有的作業都被取消了";
			close;
		case 2:
			//if ((countitem(984) > 0) && (countitem(985) > 0) && (countitem(7049) > 29) && (countitem(717) > 4) && (countitem(715) > 4) && (countitem(716) > 4)) {
				mes "中央要依據";
				mes "石頭,鋁,神之金屬的順序來配置,";
				mes "為了要重新形成";
				mes "要配置有魔力的魔力礦石";
				next;
				switch(select("鋁:神之金屬:石頭")) {
				case 1:
					mes "在中央放上鋁";
					next;
					break;
				case 2:
					mes "在中央放上神之金屬";
					next;
					break;
				case 3:
					mes "在中央放上石頭";
					set .@nice,.@nice+10;
					next;
					break;
				}
				switch(select("鋁:神之金屬:石頭")) {
				case 1:
					mes "配置鋁";
					set .@nice,.@nice+10;
					next;
					break;
				case 2:
					mes "配置神之金屬";
					mes "with some Oridecon.^000000";
					next;
					break;
				case 3:
					mes "配置石頭";
					next;
					break;
				}
				switch(select("鋁:神之金屬:石頭")) {
				case 1:
					mes "把鋁放在最上位";
					next;
					break;
				case 2:
					mes "把神之金屬放在最上位";
					set .@nice,.@nice+10;
					next;
					break;
				case 3:
					mes "把石頭放在最上位";
					next;
					break;
				}
				mes "不違背魔法式";
				mes "要配置有魔力的魔力礦石,";
				mes "魔力的性質用準備的效果以便可得知";
				next;
				while(1) {
					if (.@roof0 > 7) {
						break;
					}
					else {
						switch(rand(1,3)) {
						case 1:
							specialeffect EF_BEGINSPELL2;
							mes "請配置跟魔力一樣的魔法式";
							mes "魔力礦石吧";
							next;
							switch(select("紅色魔力礦石:黃色魔力礦石:藍色魔力礦石")) {
							case 1:
								mes "配置紅色魔力礦石了";
								close;
							case 2:
								mes "配置黃色魔力礦石了,";
								close;
							case 3:
								mes "配置藍色魔力礦石了,";
								set .@nice,.@nice+10;
								set .@roof0,.@roof0 + 1;
								specialeffect EF_STEAL;
								next;
								break;
							}
							break;
						case 2:
							specialeffect EF_VOLCANO;
							mes "請配置跟魔力一樣的魔法式";
							mes "魔力礦石吧";
							next;
							switch(select("紅色魔力礦石:黃色魔力礦石:藍色魔力礦石")) {
							case 1:
								mes "配置紅色魔力礦石了";
								set .@nice,.@nice+10;
								set .@roof0,.@roof0 + 1;
								specialeffect EF_STEAL;
								next;
								break;
							case 2:
								mes "配置黃色魔力礦石了,";
								close;
							case 3:
								mes "配置藍色魔力礦石了,";
								close;
							}
							break;
						case 3:
							specialeffect EF_BEGINSPELL4;
							mes "請配置跟魔力一樣的魔法式";
							mes "魔力礦石吧";
							next;
							switch(select("紅色魔力礦石:黃色魔力礦石:藍色魔力礦石")) {
							case 1:
								mes "配置紅色魔力礦石了";
								close;
							case 2:
								mes "配置黃色魔力礦石了,";
								set .@nice,.@nice+10;
								set .@roof0,.@roof0 + 1;
								specialeffect EF_STEAL;
								next;
								break;
							case 3:
								mes "配置藍色魔力礦石了,";
								close;
							}
						}
					}
				}
				if (.@nice > 90) {
					if ($agit_sc01[1] == 0) {
						mes "守護石重新的形成已經被完成了";
						close;
					}
					else {
						if (agitcheck2() == 0) {
							mes "因魔力互相的衝突";
							mes "對守護石重新的形成失敗了";
							close;
						}
						else {
							mes "已經完成魔力礦石的配置,";
							mes "守護石的重新形成是成功的!!!";
							close2;
							donpcevent "#sch01_df02::OnEnable";
							specialeffect EF_ICECRASH;
							disablenpc "第2守護石#sch01";
							setarray $agit_sc01[1],0;
							set .@df_all,$agit_sc01[0]+$agit_sc01[1];
							if (.@df_all == 0) {
								mapannounce "schg_cas01","守護石已完全的修復 開始強化警戒了",bc_map,"0x00ff00";
								donpcevent "#sch01_RL00::OnEnable";
							}
							else {
								mapannounce "schg_cas01","第2守護石重新形成 已成功了!",bc_map,"0x00ff00";
							}
							if ($agit_sc01[5] == 1) {
								donpcevent "#sch01_gard02::OnEnable";
							}
							end;
						}
					}
				}
				else {
					mes "所有的作業都做完後.. 碰咚碰咚的響著";
					mes "沒有任何的反應";
					mes "看樣子是失敗的樣子,";
					close;
				}
		}
	}
	end;

OnInit:
	disablenpc "第2守護石#sch01";
	end;

OnEnable:
	enablenpc "第2守護石#sch01";
	specialeffect EF_MAPPILLAR2;
	end;

OnDisable:
	disablenpc "第2守護石#sch01";
	end;
}

// Barrier Summoners
schg_cas01,2,1,0	script	#sch01_RL00	-1,{
OnEnable:
	setcell "schg_cas01",114,48,126,48,cell_walkable,0;
	setcell "schg_cas01",114,48,126,48,cell_shootable,0;
	guardian "schg_cas01",115,49," ",1906,"#sch01_RL00::OnBarrierDestroyed"; //24;
	guardian "schg_cas01",117,49," ",1906,"#sch01_RL00::OnBarrierDestroyed"; //25;
	guardian "schg_cas01",119,49," ",1906,"#sch01_RL00::OnBarrierDestroyed"; //26;
	guardian "schg_cas01",121,49," ",1906,"#sch01_RL00::OnBarrierDestroyed"; //27;
	guardian "schg_cas01",123,49," ",1906,"#sch01_RL00::OnBarrierDestroyed"; //28;
	guardian "schg_cas01",125,49," ",1906,"#sch01_RL00::OnBarrierDestroyed"; //29;
	end;

OnDisable:
	setcell "schg_cas01",114,48,126,48,cell_walkable,1;
	setcell "schg_cas01",114,48,126,48,cell_shootable,1;
	killmonster "schg_cas01","#sch01_RL00::OnBarrierDestroyed";
	end;

OnBarrierDestroyed:
	end;
}

schg_cas01,2,2,0	script	#sch01_RL01	-1,{
OnEnable:
	set .MyMobCount,6;
	setcell "schg_cas01",114,51,126,51,cell_walkable,0;
	guardian "schg_cas01",115,50," ",1906,"#sch01_RL01::OnBarrierDestroyed"; //30;
	guardian "schg_cas01",117,50," ",1906,"#sch01_RL01::OnBarrierDestroyed"; //31;
	guardian "schg_cas01",119,50," ",1906,"#sch01_RL01::OnBarrierDestroyed"; //32;
	guardian "schg_cas01",121,50," ",1906,"#sch01_RL01::OnBarrierDestroyed"; //33;
	guardian "schg_cas01",123,50," ",1906,"#sch01_RL01::OnBarrierDestroyed"; //34;
	guardian "schg_cas01",125,50," ",1906,"#sch01_RL01::OnBarrierDestroyed"; //35;
	end;

OnBarrierDestroyed:
	set .MyMobCount,.MyMobCount-1;
	if (.MyMobCount == 0) {
		setarray $agit_sc01[2],1;
		mapannounce "schg_cas01","第1防禦線 被突破掉了",bc_map,"0x00ff00";
		setcell "schg_cas01",114,51,126,51,cell_walkable,1;
	}
	end;

OnDisable:
	setcell "schg_cas01",114,51,126,51,cell_walkable,1;
	killmonster "schg_cas01","#sch01_RL01::OnBarrierDestroyed";
	end;
}

schg_cas01,2,3,0	script	#sch01_RL02	-1,{
OnEnable:
	set .MyMobCount,6;
	setcell "schg_cas01",114,154,126,154,cell_walkable,0;
	guardian "schg_cas01",115,153," ",1906,"#sch01_RL02::OnBarrierDestroyed"; //36;
	guardian "schg_cas01",117,153," ",1906,"#sch01_RL02::OnBarrierDestroyed"; //37;
	guardian "schg_cas01",119,153," ",1906,"#sch01_RL02::OnBarrierDestroyed"; //38;
	guardian "schg_cas01",121,153," ",1906,"#sch01_RL02::OnBarrierDestroyed"; //39;
	guardian "schg_cas01",123,153," ",1906,"#sch01_RL02::OnBarrierDestroyed"; //40;
	guardian "schg_cas01",125,153," ",1906,"#sch01_RL02::OnBarrierDestroyed"; //41;
	end;

OnBarrierDestroyed:
	set .MyMobCount,.MyMobCount-1;
	if (.MyMobCount == 0) {
		setarray $agit_sc01[3],1;
		mapannounce "schg_cas01","第2防禦線 被突破掉了",bc_map,"0x00ff00";
		setcell "schg_cas01",114,154,126,154,cell_walkable,1;
	}
	end;

OnDisable:
	setcell "schg_cas01",114,154,126,154,cell_walkable,1;
	killmonster "schg_cas01","#sch01_RL02::OnBarrierDestroyed";
	end;
}

schg_cas01,2,4,0	script	#sch01_RL03	-1,{
OnEnable:
	set .MyMobCount,4;
	setcell "schg_cas01",116,241,126,241,cell_walkable,0;
	guardian "schg_cas01",116,240," ",1906,"#sch01_RL03::OnBarrierDestroyed"; //42;
	guardian "schg_cas01",118,240," ",1906,"#sch01_RL03::OnBarrierDestroyed"; //43;
	guardian "schg_cas01",120,240," ",1906,"#sch01_RL03::OnBarrierDestroyed"; //44;
	guardian "schg_cas01",122,240," ",1906,"#sch01_RL03::OnBarrierDestroyed"; //45;
	end;

OnBarrierDestroyed:
	set .MyMobCount,.MyMobCount-1;
	if (.MyMobCount == 0) {
		setarray $agit_sc01[4],1;
		mapannounce "schg_cas01","第3防禦線 被突破掉了!!",bc_map,"0x00ff00";
		setcell "schg_cas01",116,241,126,241,cell_walkable,1;
	}
	end;

OnDisable:
	setcell "schg_cas01",116,241,126,241,cell_walkable,1;
	killmonster "schg_cas01","#sch01_RL03::OnBarrierDestroyed";
	end;
}

schg_cas01,124,52,0	script	控制裝置01#sch01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		if (strcharinfo(0) == getguildmaster(.@GID)) {
			if ($agit_sc01[2] == 2) {
				mes "^3355FF你占領據點後";
				mes "防禦線是可以修復的,";
				next;
				select("繼續");
				//if ((countitem(1019) > 29) && (countitem(999) > 9) && (countitem(1011) > 9) && (countitem(984) > 4)) {
					mes "^3355FF你要修復防禦線,";
					mes "必須依照他的損壞情形來放入適合的修復材料,";
					mes "才可以正確的修復防禦線^000000";
					next;
					set .@ro_of01,rand(10,15);
					while(1) {
						if (.@ro_of02 == .@ro_of01) {
							break;
						}
						else {
							switch(rand(1,4)) {
							case 1:
								mes "^3355FF支撐者防禦線的框架,";
								mes "已經嚴重損壞,";
								mes "必須馬上將他固定";
								mes "所需材料:瑪哪樹枝.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF防禦線的框架";
									mes "經由木材的強化已經修復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
								break;
							case 2:
								mes "^3355FF它看起來像防禦線的";
								mes "防禦力已經嚴重降低";
								mes "需要使用加強防禦的材料";
								mes "所需材料:神之金屬.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材";
									mes "加強防禦線.^000000";
									set .@ro_of02,.@ro_of02 + 1;
									next;
									break;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF你重建了防禦線";
									mes "它看起來";
									mes "就跟全新的一樣.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								}
								break;
							case 3:
								mes "^3355FF這種損害的防禦線";
								mes "已經布滿了裂痕";
								mes "你必須準備焊接的材料";
								mes "將這些裂痕焊接牢固";
								mes "所需材料:鋼鐵.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材來修復";
									mes "但他並非現在所需要的材料";
									mes "使得情況更為惡化了.";
									mes "必須從頭開始.^000000";
									close;
								case 2:
									mes "^3355FF你用鋼材焊接";
									mes "所有的裂痕被你焊接牢固";
									mes "防禦線已經被修復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
								break;
							case 4:
								mes "^3355FF現在你需要";
								mes "重新建立一道防禦線";
								mes "所需材料:強化武器金屬.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材來修復";
									mes "但他並非現在所需要的材料";
									mes "使得情況更為惡化了.";
									mes "必須從頭開始.^000000";
									close;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您成功地利用";
									mes "強化武器金屬修復成功";
									mes "把防禦線的防禦都恢復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
							}
						}
					}
					mes "^3355FF它看起來像已經損壞";
					mes "你必須要準備";
					mes "修復防禦線.^000000";
					next;
					if (agitcheck2() == 0) {
						mes "^3355FF不幸的是,城堡的";
						mes "防禦線不能重建:";
						mes "這裡的防禦線還是沒有.^000000";
						close;
					}
					else {
						if (.@rp_temp == .@ro_of01) {
							mes "^3355FF該防禦線";
							mes "已成功修復!^000000";
							close2;
							donpcevent "#sch01_RL01::OnEnable";
							disablenpc "控制裝置01#sch01";
							mapannounce "schg_cas01","第 1 防禦線 重新建置成功了!",bc_map,"0x00ff00";
							setarray $agit_sc01[2],0;
							end;
						}
						else {
							mes "^3355FF防禦線已經損壞,";
							mes "你試圖修復他";
							mes "但很可惜的失敗了.";
							close;
						}
					}
			}
		}
	}
	end;

OnInit:
	disablenpc "控制裝置01#sch01";
	end;

OnEnable:
	enablenpc "控制裝置01#sch01";
	end;

OnDisable:
	disablenpc "控制裝置01#sch01";
	end;
}

schg_cas01,128,157,0	script	控制裝置02#sch01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		if (strcharinfo(0) == getguildmaster(.@GID)) {
			if ($agit_sc01[3] == 2) {
				mes "^3355FF你占領據點後";
				mes "防禦線是可以修復的,";
				next;
				select("繼續");
				//if ((countitem(1019) > 29) && (countitem(999) > 9) && (countitem(1011) > 9) && (countitem(984) > 4)) {
					mes "^3355FF你必須花費一些時間來";
					mes "修復防禦線,";
					mes "你要修復防禦線,";
					mes "必須依照他的損壞情形來放入適合的修復材料,";
					mes "才可以正確的修復防禦線^000000";
					next;
					set .@ro_of01,rand(10,15);
					while(1) {
						if (.@ro_of02 == .@ro_of01) {
							break;
						}
						else {
							switch(rand(1,4)) {
							case 1:
								mes "^3355FF支撐者防禦線的框架,";
								mes "已經嚴重損壞,";
								mes "必須馬上將他固定";
								mes "所需材料:瑪哪樹枝.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF防禦線的框架";
									mes "經由木材的強化已經修復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
								break;
							case 2:
								mes "^3355FF它看起來像防禦線的";
								mes "防禦力已經嚴重降低";
								mes "需要使用加強防禦的材料";
								mes "所需材料:神之金屬.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材";
									mes "加強防禦線.^000000";
									set .@ro_of02,.@ro_of02 + 1;
									next;
									break;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF你重建了防禦線";
									mes "它看起來";
									mes "就跟全新的一樣.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								}
								break;
							case 3:
								mes "^3355FF這種損害的防禦線";
								mes "已經布滿了裂痕";
								mes "你必須準備焊接的材料";
								mes "將這些裂痕焊接牢固";
								mes "所需材料:鋼鐵.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材來修復";
									mes "但他並非現在所需要的材料";
									mes "使得情況更為惡化了.";
									mes "必須從頭開始.^000000";
									close;
								case 2:
									mes "^3355FF你用鋼材焊接";
									mes "所有的裂痕被你焊接牢固";
									mes "防禦線已經被修復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
								break;
							case 4:
								mes "^3355FF現在你需要";
								mes "重新建立一道防禦線";
								mes "所需材料:強化武器金屬.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材來修復";
									mes "但他並非現在所需要的材料";
									mes "使得情況更為惡化了.";
									mes "必須從頭開始.^000000";
									close;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您成功地利用";
									mes "強化武器金屬修復成功";
									mes "把防禦線的防禦都恢復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
							}
						}
					}
					mes "^3355FF它看起來像已經損壞";
					mes "你必須要準備";
					mes "修復防禦線.^000000";
					next;
					if (agitcheck2() == 0) {
						mes "^3355FF不幸的是,城堡的";
						mes "防禦線不能重建:";
						mes "這裡的防禦線還是沒有.^000000";
						close;
					}
					else {
						if (.@rp_temp == .@ro_of01) {
							mes "^3355FF該防禦線";
							mes "已成功修復!^000000";
							close2;
							donpcevent "#sch01_RL02::OnEnable";
							disablenpc "控制裝置02#sch01";
							mapannounce "schg_cas01","第 2 防禦線 重新建置成功了!",bc_map,"0x00ff00";
							setarray $agit_sc01[3],0; //Global Variable
							setarray $agit_sc01[2],2; //Global Variable
							donpcevent "控制裝置01#sch01::OnEnable";
							end;
						}
						else {
							mes "^3355FF防禦線已經損壞,";
							mes "你試圖修復他";
							mes "但很可惜的失敗了.";
							mes "你失去了一些";
							mes "修復的材料...^000000";
							close;
						}
					}
			}
		}
	}
	end;

OnInit:
	disablenpc "控制裝置02#sch01";
	end;

OnEnable:
	enablenpc "控制裝置02#sch01";
	end;

OnDisable:
	disablenpc "控制裝置02#sch01";
	end;
}

schg_cas01,109,247,0	script	控制裝置03#sch01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		if (strcharinfo(0) == getguildmaster(.@GID)) {
			if ($agit_sc01[4] == 2) {
				mes "^3355FF你占領據點後";
				mes "防禦線是可以修復的,";
				next;
				select("繼續");
				//if ((countitem(1019) > 29) && (countitem(999) > 9) && (countitem(1011) > 9) && (countitem(984) > 4)) {
					mes "^3355FF你要修復防禦線,";
					mes "必須依照他的損壞情形來放入適合的修復材料,";
					mes "才可以正確的修復防禦線^000000";
					next;
					set .@ro_of01,rand(10,15);
					while(1) {
						if (.@ro_of02 == .@ro_of01) {
							break;
						}
						else {
							switch(rand(1,4)) {
							case 1:
								mes "^3355FF支撐者防禦線的框架,";
								mes "已經嚴重損壞,";
								mes "必須馬上將他固定";
								mes "所需材料:瑪哪樹枝.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF防禦線的框架";
									mes "經由木材的強化已經修復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
								break;
							case 2:
								mes "^3355FF它看起來像防禦線的";
								mes "防禦力已經嚴重降低";
								mes "需要使用加強防禦的材料";
								mes "所需材料:神之金屬.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材";
									mes "加強防禦線.^000000";
									set .@ro_of02,.@ro_of02 + 1;
									next;
									break;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF你重建了防禦線";
									mes "它看起來";
									mes "就跟全新的一樣.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								}
								break;
							case 3:
								mes "^3355FF這種損害的防禦線";
								mes "已經布滿了裂痕";
								mes "你必須準備焊接的材料";
								mes "將這些裂痕焊接牢固";
								mes "所需材料:鋼鐵.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材來修復";
									mes "但他並非現在所需要的材料";
									mes "使得情況更為惡化了.";
									mes "必須從頭開始.^000000";
									close;
								case 2:
									mes "^3355FF你用鋼材焊接";
									mes "所有的裂痕被你焊接牢固";
									mes "防禦線已經被修復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 3:
									mes "^3355FF您試圖使用強化武器金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
								break;
							case 4:
								mes "^3355FF現在你需要";
								mes "重新建立一道防禦線";
								mes "所需材料:強化武器金屬.^000000";
								next;
								switch(select("瑪哪樹枝:鋼鐵:強化武器金屬-級數二:神之金屬")) {
								case 1:
									mes "^3355FF您試圖使用木材來修復";
									mes "但他並非現在所需要的材料";
									mes "使得情況更為惡化了.";
									mes "必須從頭開始.^000000";
									close;
								case 2:
									mes "^3355FF您試圖使用鋼鐵修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								case 3:
									mes "^3355FF您成功地利用";
									mes "強化武器金屬修復成功";
									mes "把防禦線的防禦都恢復了.^000000";
									set .@rp_temp,.@rp_temp + 1;
									set .@ro_of02,.@ro_of02 + 1;
									specialeffect2 EF_REPAIRWEAPON;
									next;
									break;
								case 4:
									mes "^3355FF您試圖使用神之金屬修復,";
									mes "但他並非現在所需要的材料";
									mes "你必須在嘗試使用";
									mes "其他的材料來修復防禦線.^000000";
									close;
								}
							}
						}
					}
					mes "^3355FF它看起來像已經損壞";
					mes "你必須要準備";
					mes "修復防禦線.^000000";
					next;
					if (agitcheck2() == 0) {
						mes "^3355FF不幸的是,城堡的";
						mes "防禦線不能重建:";
						mes "這裡的防禦線還是沒有.^000000";
						close;
					}
					else {
						if (.@rp_temp == .@ro_of01) {
							mes "^3355FF該防禦線";
							mes "已成功修復!^000000";
							close2;
							donpcevent "#sch01_RL03::OnEnable";
							disablenpc "控制裝置03#sch01";
							mapannounce "schg_cas01","第 3 防禦線 重新建置成功了!",bc_map,"0x00ff00";
							setarray $agit_sc01[4],0;
							setarray $agit_sc01[3],2;
							donpcevent "控制裝置02#sch01::OnEnable";
							end;
						}
						else {
							mes "^3355FF防禦線已經損壞,";
							mes "你試圖修復他";
							mes "但很可惜的失敗了.";
							close;
						}
					}
			}
		}
	}
	end;

OnInit:
	disablenpc "控制裝置03#sch01";
	end;

OnEnable:
	enablenpc "控制裝置03#sch01";
	end;

OnDisable:
	disablenpc "控制裝置03#sch01";
	end;
}

// Link Flags
schg_cas01,106,302,0	script	LF-01#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("第 1 據點:第 2 據點:取消")) {
		case 1:
			warp "schg_cas01",19,26;
			end;
		case 2:
			warp "schg_cas01",219,90;
			end;
		case 3:
			close;
		}
	}
	end;
}

schg_cas01,109,302,0	script	LF-02#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("防禦地區 1-1:防禦地區 1-2:取消")) {
		case 1:
			warp "schg_cas01",89,43;
			end;
		case 2:
			warp "schg_cas01",141,45;
			end;
		case 3:
			close;
		}
	}
	end;
}

schg_cas01,112,302,0	script	LF-03#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("防禦地區 2-1:防禦地區 2-2:取消")) {
		case 1:
			warp "schg_cas01",137,54;
			end;
		case 2:
			warp "schg_cas01",102,54;
			end;
		case 3:
			close;
		}
	}
	end;
}

schg_cas01,115,302,0	script	LF-04#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("防禦地區 2-3:防禦地區 2-4:取消")) {
		case 1:
			warp "schg_cas01",94,147;
			end;
		case 2:
			warp "schg_cas01",163,140;
			end;
		case 3:
			close;
		}
	}
	end;
}

schg_cas01,118,302,0	script	LF-05#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("防禦地區 2-3:防禦地區 2-4:取消")) {
		case 1:
			warp "schg_cas01",87,220;
			end;
		case 2:
			warp "schg_cas01",151,220;
			end;
		case 3:
			close;
		}
	}
	end;
}

schg_cas01,121,302,0	script	LF-06#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("防禦地區 3-1:防禦地區 3-2:取消")) {
		case 1:
			warp "schg_cas01",100,242;
			end;
		case 2:
			warp "schg_cas01",136,242;
			end;
		case 3:
			close;
		}
	}
	end;
}

schg_cas01,124,302,0	script	LF-07#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("中央地區 1:中央地區 2:取消")) {
		case 1:
			warp "schg_cas01",120,168;
			end;
		case 2:
			warp "schg_cas01",119,211;
			end;
		case 3:
			close;
		}
	}
	end;
}

schg_cas01,127,302,0	script	LF-08#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("區域 1-1:區域 2-1:區域 3-1:取消")) {
		case 1:
			warp "schg_cas01",89,43;
			end;
		case 2:
			warp "schg_cas01",94,147;
			end;
		case 3:
			warp "schg_cas01",100,242;
			end;
		case 4:
			close;
		}
	}
	end;
}

schg_cas01,130,302,0	script	LF-09#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "請選擇要移動的場所";
		switch(select("區域 1-2:區域 2-3:區域 3-2:取消")) {
		case 1:
			warp "schg_cas01",141,45;
			end;
		case 2:
			warp "schg_cas01",163,140;
			end;
		case 3:
			warp "schg_cas01",136,243;
			end;
		case 4:
			close;
		}
	}
	end;
}

schg_cas01,133,302,0	script	LF-10#schg_cas01	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "可以移動到為了會員們的便利所形成的區域,";
		mes "請問你要移動嗎?";
		switch(select("移動到便利的區域:取消")) {
		case 1:
			warp "schg_cas01",275,244;
			end;
		case 2:
			close;
		}
	}
	end;
}

schg_cas01,17,45,0	script	喜民#LF_sc01_1::LF_sc01_1	111,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "移動到有華麗金屬中央的戰略地區,";
		mes "請問你要使用嗎?";
		switch(select("移動:取消")) {
		case 1:
			warp "schg_cas01",120,290;
			end;
		case 2:
			close;
		}
	}
	end;
}

schg_cas01,207,95,0	duplicate(LF_sc01_1)	喜民#LF_sc01_2	111

schg_cas01,111,46,4	script	喜民#LF_sc01_3::LF_sc01_2	722,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID) {
		mes "-秘密基地內部 空間移動系統-";
		mes "移動到有華麗金屬中央的戰略地區,";
		mes "請問你要使用嗎?";
		switch(select("移動:取消")) {
		case 1:
			warp "schg_cas01",120,290;
			end;
		case 2:
			close;
		}
	}
	end;

OnRecvCastleSc01:
	FlagEmblem GetCastleData("schg_cas01",1);
	end;
}

schg_cas01,129,46,4	duplicate(LF_sc01_2)	喜民#LF_sc01_4	722
schg_cas01,99,77,0	duplicate(LF_sc01_1)	喜民#LF_sc01_5	111
schg_cas01,140,77,0	duplicate(LF_sc01_1)	喜民#LF_sc01_6	111
schg_cas01,109,150,4	duplicate(LF_sc01_2)	喜民#LF_sc01_7	722
schg_cas01,130,150,4	duplicate(LF_sc01_2)	喜民#LF_sc01_8	722
schg_cas01,112,212,0	duplicate(LF_sc01_1)	喜民#LF_sc01_9	111
schg_cas01,127,212,0	duplicate(LF_sc01_1)	喜民#LF_sc01_10	111
schg_cas01,113,238,0	duplicate(LF_sc01_1)	喜民#LF_sc01_11	111
schg_cas01,126,238,0	duplicate(LF_sc01_1)	喜民#LF_sc01_12	111
schg_cas01,95,247,0	duplicate(LF_sc01_1)	喜民#LF_sc01_13	111
schg_cas01,144,247,0	duplicate(LF_sc01_1)	喜民#LF_sc01_14	111

// Guild Manager
schg_cas01,247,305,3	script	管理人#sch01	55,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (.@GID == 0) {
		mes "[ 管理人 ]";
		mes "我在此等待我的主人... 勇敢的冒險者啊! 追隨你的命運吧!";
		close;
	}
	if (getcharid(2) != .@GID || strcharinfo(0) != getguildmaster(.@GID)) {
		mes "[ 管理人 ]";
		mes "不管你們怎麼威脅我,我只願意追隨我的主人 ^FF0000" + getguildmaster(.@GID) + "^000000 !";
		mes "監護人你們在哪裡呀!";
		mes "趕快把這些無理的傢伙們趕走吧!";
		close;
	}
	mes "[ 管理人 ]";
	mes "歡迎光臨,我的主人 ^FF0000" + getguildmaster(.@GID) + "^000000先生/小姐...";
	mes "請儘管吩咐,我將忠誠地為你完成任務";
	next;
	switch(select("查看秘密基地狀況:投資商業發展度:投資防禦度:雇用 / 解雇 倉庫職員:進入主人房間")) {
	case 1:
		mes "[ 管理人 ]";
		mes "現在向你報告秘密基地的狀況";
		mes "現在商業發展度是 ^0000ff" + GetCastleData("schg_cas01",2) + " ";
		if (GetCastleData("schg_cas01",4) > 0) {
			mes "在過去一天之內,";
			mes "投資了 " + GetCastleData("schg_cas01",4) + " 次";
		}
		next;
		mes "[ 管理人 ]";
		mes "現在的防禦度是 " + GetCastleData("schg_cas01",3) + " ";
		if (GetCastleData("schg_cas01",5) > 0) {
			mes "在過去一天之內,";
			mes "投資了 " + GetCastleData("schg_cas01",5) + " 次";
		}
		mes " ";
		mes "報告完畢";
		close;
	case 2:
		set .@Economy,GetCastleData("schg_cas01",2);
		if (.@Economy < 6) { set .@eco_invest,5000; }
		else if ((.@Economy >= 6) && (.@Economy <= 10)) { set .@eco_invest,10000; }
		else if ((.@Economy >= 11) && (.@Economy <= 15)) { set .@eco_invest,20000; }
		else if ((.@Economy >= 16) && (.@Economy <= 20)) { set .@eco_invest,35000; }
		else if ((.@Economy >= 21) && (.@Economy <= 25)) { set .@eco_invest,55000; }
		else if ((.@Economy >= 26) && (.@Economy <= 30)) { set .@eco_invest,80000; }
		else if ((.@Economy >= 31) && (.@Economy <= 35)) { set .@eco_invest,110000; }
		else if ((.@Economy >= 36) && (.@Economy <= 40)) { set .@eco_invest,145000; }
		else if ((.@Economy >= 41) && (.@Economy <= 45)) { set .@eco_invest,185000; }
		else if ((.@Economy >= 46) && (.@Economy <= 50)) { set .@eco_invest,230000; }
		else if ((.@Economy >= 51) && (.@Economy <= 55)) { set .@eco_invest,280000; }
		else if ((.@Economy >= 56) && (.@Economy <= 60)) { set .@eco_invest,335000; }
		else if ((.@Economy >= 61) && (.@Economy <= 65)) { set .@eco_invest,395000; }
		else if ((.@Economy >= 66) && (.@Economy <= 70)) { set .@eco_invest,460000; }
		else if ((.@Economy >= 71) && (.@Economy <= 75)) { set .@eco_invest,530000; }
		else if ((.@Economy >= 76) && (.@Economy <= 80)) { set .@eco_invest,605000; }
		else if ((.@Economy >= 81) && (.@Economy <= 85)) { set .@eco_invest,685000; }
		else if ((.@Economy >= 86) && (.@Economy <= 90)) { set .@eco_invest,770000; }
		else if ((.@Economy >= 91) && (.@Economy <= 95)) { set .@eco_invest,860000; }
		else if ((.@Economy >= 96) && (.@Economy <= 100)) { set .@eco_invest,955000; }
		//Quadruple the cost of investing if you've already invested once.
		if (GetCastleData("schg_cas01",4)) {
			set .@eco_invest,.@eco_invest*4;
		}
		mes "[ 管理人 ]";
		mes "提高商業發展度的話,在工會裡生產的物品數量會增加,為了以後著想的話,不能不投資啊";
		mes " ";
		mes "照原先的方式,一天只能投資一次,假如多付一點金錢的話,一天可以投資兩次";
		mes " ";
		if (.@Economy == 100) {
			mes "^FF0000目前防禦度以經是100了,你已經不需要再加入任何投資了^000000";
			close;
		}
		if (GetCastleData("schg_cas01",4) == 2) {
			mes "^FF0000可是你已經在今天之內投資了兩次再不能投資了,^000000讓發展度趕快上升期待著富貴的日子囉";
			close;
		}
		if (GetCastleData("schg_cas01",4) == 0) {
			mes "現在需要投資的金額是 ^FF0000" + .@eco_invest + "^000000 金幣,請問你要投資嗎?";
		}
		else {
			mes "現在你已經投資一次了...";
			mes "還要再投資嗎? 還需要追加^FF0000" + .@eco_invest + "^000000";
			mes "金幣噢";
		}
		next;
		switch(select("投資商業發展度:取消")) {
		case 1:
			if (Zeny < .@eco_invest) {
				mes "[ 管理人 ]";
				mes "主人,你沒有足夠的資金可以投資商業發展度";
				end;
			}
			set zeny,zeny-.@eco_invest;
			SetCastleData "schg_cas01",4,GetCastleData("schg_cas01",4)+1;
			mes "[ 管理人 ]";
			mes "順利地完成投資了!";
			mes "期待著我們往後要面臨的未來,明天的話發展度會上升";
			close;
		case 2:
			mes "[ 管理人 ]";
			mes "我將依照你的吩咐去執行,是我的主人";
			mes "... 不需要太著急,我們會做得很好";
			close;
		}
	case 3:
		set .@Defence,GetCastleData("schg_cas01",3);
		if (.@Defence < 6) { set .@def_invest,10000; }
		else if ((.@Defence >= 6) && (.@Defence <= 10)) { set .@def_invest,20000; }
		else if ((.@Defence >= 11) && (.@Defence <= 15)) { set .@def_invest,40000; }
		else if ((.@Defence >= 16) && (.@Defence <= 20)) { set .@def_invest,70000; }
		else if ((.@Defence >= 21) && (.@Defence <= 25)) { set .@def_invest,110000; }
		else if ((.@Defence >= 26) && (.@Defence <= 30)) { set .@def_invest,160000; }
		else if ((.@Defence >= 31) && (.@Defence <= 35)) { set .@def_invest,220000; }
		else if ((.@Defence >= 36) && (.@Defence <= 40)) { set .@def_invest,290000; }
		else if ((.@Defence >= 41) && (.@Defence <= 45)) { set .@def_invest,370000; }
		else if ((.@Defence >= 46) && (.@Defence <= 50)) { set .@def_invest,460000; }
		else if ((.@Defence >= 51) && (.@Defence <= 55)) { set .@def_invest,560000; }
		else if ((.@Defence >= 56) && (.@Defence <= 60)) { set .@def_invest,670000; }
		else if ((.@Defence >= 61) && (.@Defence <= 65)) { set .@def_invest,790000; }
		else if ((.@Defence >= 66) && (.@Defence <= 70)) { set .@def_invest,920000; }
		else if ((.@Defence >= 71) && (.@Defence <= 75)) { set .@def_invest,1060000; }
		else if ((.@Defence >= 76) && (.@Defence <= 80)) { set .@def_invest,1210000; }
		else if ((.@Defence >= 81) && (.@Defence <= 85)) { set .@def_invest,1370000; }
		else if ((.@Defence >= 86) && (.@Defence <= 90)) { set .@def_invest,1540000; }
		else if ((.@Defence >= 91) && (.@Defence <= 95)) { set .@def_invest,1720000; }
		else if ((.@Defence >= 96) && (.@Defence <= 100)) { set .@def_invest,1910000; }
		//Quadruple the cost of investing if you've already invested once.
		if (GetCastleData("schg_cas01",5)) {
			set .@def_invest,.@def_invest*4;
		}
		mes "[ 管理人 ]";
		mes "提高防禦程度的話,監護人和華麗金屬的耐久度會增加,考慮到往後的戰爭,不得不投資啊,";
		mes " ";
		mes "照原先的方式,一天只能投資一次,假如多付一點金錢的話,一天可以投資兩次";
		mes " ";
		if (GetCastleData("schg_cas01",3) == 100) {
			mes "^FF0000目前防禦度以經是100了,你已經不需要再加入任何投資了^000000";
			close;
		}
		if (GetCastleData("schg_cas01",5) == 2) {
			mes "^FF0000可是你已經在今天之內投資了兩次再不能投資了,^000000讓發展度趕快上升期待著富貴的日子囉";
			close;
		}
		if (GetCastleData("schg_cas01",5) == 0) {
			mes "現在需要投資的金額是 ^FF0000" + .@def_invest + "^000000 金幣,請問你要投資嗎?";
		}
		else {
			mes "現在你已經投資一次了...";
			mes "還要再投資嗎? 還需要追加 ^FF0000" + .@def_invest + "^000000";
			mes "金幣噢";
		}
		next;
		switch(select("投資防禦度:取消")) {
		case 1:
			if (Zeny < .@def_invest) {
				mes "[ 管理人 ]";
				mes "主人,你沒有足夠的資金可以投資防禦度";
				close;
			}
			set zeny,zeny-.@def_invest;
			SetCastleData "schg_cas01",5,GetCastleData("schg_cas01",5)+1;
			mes "[ 管理人 ]";
			mes "順利地完成投資了!";
			mes "期待著我們往後要面臨的未來,明天的話發展度會上升";
			close;
		case 2:
			mes "[ 管理人 ]";
			mes "我將依照你的吩咐去執行,是我的主人";
			mes "... 不需要太著急,我們會做得很好";
			close;
		}
	case 4:
		if (GetCastleData("schg_cas01",9) == 1) {
			mes "[ 管理人 ]";
			mes "請問您要解雇卡普拉服務人員嗎?";
			next;
			switch(select("解雇:取消")) {
			case 1:
				cutin "kafra_01",2;
				mes "[ 卡普拉 職員 ]";
				mes "我做錯了什麼事嗎?如果我有做錯事的話,能請您原諒我,再給我一次機會嗎?";
				next;
				switch(select("解雇:取消")) {
				case 1:
					mes "[ 卡普拉 職員 ]";
					mes "不能夠繼續為您服務真是我最大的遺憾...";
					next;
					cutin "kafra_01",255;
					break;
				case 2:
					mes "[ 卡普拉 職員 ]";
					mes "我會努力勤奮的為您服務的!";
					close;
				}
				break;
			case 2:
				mes "[ 管理人 ]";
				mes "主人,我想我們應該要留下現在這位卡普拉職員,因為她已經竭盡所能地為我們服務了!";
				close;
			}
			disablenpc "卡普拉 職員#schg_cas01";
			SetCastleData "schg_cas01",9,0;
			mes "[ 管理人 ]";
			mes "卡普拉職員已經解雇了... 不過為了辛苦的會員著想,雇用卡普拉職員為上策啊";
			close;
		}
		else {
			mes "[ 管理人 ]";
			mes "和卡普拉總公司訂契約後,想要在秘密基地裡面,雇用卡普拉職員嗎?";
			mes "想要雇用的話,需要 ^FF000010,000 金幣^000000";
			next;
			switch(select("雇用:取消")) {
			case 1:
				if (getgdskilllv(.@GID,10001) == 0) {
					mes "[ 管理人 ]";
					mes "主人,如今還沒跟卡普拉總公司訂契約狀況,所以還不能雇用卡普拉職員,假如想要跟卡普拉總公司簽訂契約的話,先學會工會技能中 ^FF0000和卡普拉訂契約^000000的技能吧";
					close;
				}
				if (Zeny < 10000) {
					mes "[ 管理人 ]";
					mes "主人,你沒有足夠的資金可以雇用卡普拉職員";
					close;
				}
				set zeny,zeny-10000;
				enablenpc "卡普拉 職員#sch01";
				SetCastleData "schg_cas01",9,1;
				mes "[ 管理人 ]";
				mes "成功的和卡普拉總公司簽訂契約了,您雇用了一位卡普拉職員!";
				next;
				cutin "kafra_01",2;
				mes "[ 卡普拉 職員 ]";
				mes "您好嗎?我是總公司派來的卡普拉職員!我將會竭盡所能地為您服務!";
				next;
				cutin "kafra_01",255;
				mes "[ 管理人 ]";
				mes "雇用的卡普拉職員將有^FF00001 個月的時間^000000在此服務,時間到了之後必須重新簽訂契約";
				close;
			case 2:
				mes "[ 管理人 ]";
				mes "我已經按照你的吩咐做了,不過也要為了辛苦的會員著想,早日雇用卡普拉職員為上策啊";
				close;
			}
		}
	case 5:
		mes "[ 管理人 ]";
		mes "要到我們生產品囤積的,真貴物品房間嗎?";
		mes "那個地方是為了我們的主人,的專屬於你的地方...";
		mes "除了你之外,其它人都不能其門而入";
		next;
		mes "[ 管理人 ]";
		mes "會有物品消失的情形,敬請特別注意,";
		mes "所以為了我們公會發展,請挪出時間來收取物品";
		next;
		switch(select("要進入主人的房間:取消")) {
		case 1:
			mes "[ 管理人 ]";
			mes "我將為你服務到祕密通道那裡,請跟我來,";
			mes "回來的時候按下秘密按鈕即可";
			close2;
			warp "schg_cas01",381,381;
			end;
		case 2:
			mes "[ 管理人 ]";
			mes "生產品一天只生產一次...";
			mes "假如沒有即時收走的話,下一次就不能進來了";
			mes "所以說為了我們工會的發展,盡量花點時間去收取啊";
			close;
		}
	}

Onstop:
	stopnpctimer;
	end;

OnStartArena:
	set .@GID,getcharid(2);
	// Lower castle Economy
	set .@Economy,GetCastleData("schg_cas01",2) - 5;
	if (.@Economy < 0) set .@Economy, 0;
	SetCastleData "schg_cas01", 2, .@Economy;
	// Lower Castle Defence
	set .@Defence,GetCastleData("schg_cas01",3) - 5;
	if (.@Defence < 0) set .@Defence, 0;
	SetCastleData "schg_cas01", 3, .@Defence;
	// Set new owner
	SetCastleData "schg_cas01",1, .@GID;
	// Clear castle's data.
	for( set .@i, 4; .@i <= 9; set .@i, .@i+1 )
		SetCastleData "schg_cas01", .@i, 0;
	// Disable Kafra
	disablenpc "卡普拉 職員#sch01";

	set .msg,2;
	if (.msg == 1) {
		announce "秘密基地 [" + GetCastleName("schg_cas01") + "]的 '喜民'被 [" + getguildname(.@gid) + "] 公會所佔領了",bc_all;
		donpcevent "Manager#sch01_02::Onstart";
	}
	else if (.msg == 2) {
		announce "秘密基地 [" + GetCastleName("schg_cas01") + "]的 '喜民'被 [" + getguildname(.@gid) + "] 公會所佔領了",bc_all;
		mapannounce "schg_cas01","華麗金屬已被破壞掉了",bc_map,"0x00FF00";
		if (agitcheck2()) {
			donpcevent "Manager#sch01_02::Onreset";
			initnpctimer;
		}
		else {
			donpcevent "Manager#sch01_02::Onreset";
			stopnpctimer;
		}
	}
	else if (.msg == 0) {
		announce "秘密基地 [" + GetCastleName("schg_cas01") + "]的 '喜民'被 [" + getguildname(.@gid) + "] 公會所佔領了",bc_all;
		donpcevent "Manager#sch01_02::Onreset";
		stopnpctimer;
		end;
	}
	MapRespawnGuildID "schg_cas01",GetCastleData("schg_cas01",1),2;
	GetCastleData "schg_cas01",0,"::OnRecvCastlesc01";
	end;

OnTimer10000:
	donpcevent "Manager#sch01_02::Onchange";
	mapannounce "schg_cas01","在各個據點和防禦線的修復點數 已登場了",bc_map,"0x00FF00";
	end;
}

// Guild Kafra
schg_cas01,300,287,5	script	卡普拉 職員#sch01	117,{
	cutin "kafra_01",2;
	set .@GID, GetCastleData("schg_cas01",1);
	if (getcharid(2) == .@GID && getgdskilllv(.@GID,10001)) {
		mes "[卡普拉 職員]";
		mes "歡迎光臨 ^FF0000" + GetGuildName(.@GID) + "^000000 會員們,";
		mes "卡普拉服務";
		mes "永遠在各位身邊為您服務的";
		next;
		switch(select("使用倉庫服務:使用空間移動服務:使用手推車服務:結束")) {
		case 1:
			if (basicskillcheck() && getskilllv(1) < 6) {
				mes "[卡普拉 職員]";
				mes "對不起";
				mes "想要使用倉庫服務的話,初學者的基本技能等級要到達6級以上";
			}
			else {
				openstorage;
			}
			break;
		case 2:
			mes "[卡普拉 職員]";
			mes "請說出目的地吧";
			next;
			switch(select("朱諾  -> 200 z:取消")) {
			case 1:
				if (Zeny < 200) {
					mes "[卡普拉 職員]";
					mes "您的金額不足,";
					mes "請再確認";
					close2;
					cutin "kafra_01",255;
					end;
				}
				set zeny,zeny-200;
				warp "yuno",158,125;
				end;
			case 2:
				cutin "kafra_01",255;
			}
			break;
		case 3:
			if (BaseClass != Job_Merchant) {
				mes "[卡普拉 職員]";
				mes "很抱歉,";
				mes "手推車是商人和鐵匠,鍊金術師專用的服務";
			}
			else if (checkcart() == 1) {
				mes "[卡普拉 職員]";
				mes "您已經租過手推車了";
			}
			else {
				mes "[卡普拉 職員]";
				mes "手推車使用費用是 800 金幣";
				mes "您要使用嗎?";
				next;
				switch(select("使用:取消")) {
				case 1:
					if (Zeny < 800) {
						mes "[卡普拉 職員]";
						mes "您的金額不足,";
						mes "手推車使用費用是 800 金幣";
						close2;
						cutin "kafra_01",255;
						end;
					}
					set zeny,zeny-800;
					setcart;
					break;
				case 2:
					break;
				}
			}
			break;
		case 4:
			mes "[卡普拉 職員]";
			mes "我們卡普拉服務會提供更完美的服務和嚴格的業務管理,讓各位顧客安心便利的使用為最大的目標";
			mes "感謝你使用卡普拉服務";
			close2;
			cutin "kafra_01",255;
			end;
		}
		close2;
		cutin "kafra_01",255;
		end;
	}
	else {
		mes "[卡普拉 職員]";
		mes "我已簽訂契約專為^FF0000" + GetGuildName(.@GID) + "^000000會員服務,請使用我們其它地方的卡普拉職員,如有不便之處敬請見諒";
		close2;
		cutin "kafra_01",255;
		end;
	}

OnRecvCastlesc01:
	if (GetCastleData("schg_cas01",1) == 0) {
		monster "schg_cas01",0,0,"闇神官",1117,10;
		monster "schg_cas01",0,0,"卡利斯格",1132,4;
		monster "schg_cas01",0,0,"深淵騎士",1219,3;
		monster "schg_cas01",0,0,"行刑者",1205,1;
		monster "schg_cas01",0,0,"梅納海葵",1216,10;
		monster "schg_cas01",0,0,"鐘怪",1193,18;
		monster "schg_cas01",0,0,"古鐘魔",1269,9;
		monster "schg_cas01",0,0,"幽靈弓箭手",1276,12;
		monster "schg_cas01",0,0,"邪骸浪人",1208,3;
		monster "schg_cas01",0,0,"愛麗絲女僕",1275,1;
		monster "schg_cas01",0,0,"血腥騎士",1268,2;
		monster "schg_cas01",0,0,"黑暗之王",1272,2;
		monster "schg_cas01",0,0,"鐘塔守護者",1270,4;
	}
	if (GetCastleData("schg_cas01",9) < 1) {
		disablenpc "卡普拉 職員#sch01";
	}
	end;
}

schg_cas01,391,391,0	script	 #sch01_switch	111,{
	mes " ";
	mes "有個某種小的裝置,請問你要操作嗎?";
	next;
	switch(select("操作:結束")) {
	case 1:
		warp "schg_cas01",275,244;
		end;
	case 2:
		close;
	}
}

sch_gld,290,90,0	script	喜民#flag_sc01_1::Sc01_Flag	722,{
	set .@GID, GetCastleData("schg_cas01",1);
	if (.@GID == 0) {
		mes "[ 秀發茲發德 教國 公告令 ]";
		mes "The Holy Kingdom of";
		mes "Schwaltzvalt declares that";
		mes "one has yet to claim lordship";
		mes "over this stronghold. The one";
		mes "that breaks the Emperium will";
		mes "be recognized as its new owner.";
		close;
	}
	else {
		if (getcharid(2) == .@GID) {
			mes "[ 響亮的聲音 ]";
			mes "勇敢者們...";
			mes "你要回到你的 那名譽的時刻嗎?";
			next;
			switch(select("回到秘密基地:結束")) {
			case 1:
				set .@GID, GetCastleData("schg_cas01",1);
				if (getcharid(2) == .@GID) {
					warp "schg_cas01",120,290;
					end;
				}
				close;
			case 2:
				close;
			}
		}
		mes "[ 秀發茲發德 教國 公告令 ]";
		mes " ";
		mes "1. 根據這裡的,秀發茲發德 教國令";
		mes "這裡被認定為 ^FF0000" + GetGuildName(.@GID) + "^000000公會的";
		mes "私有物";
		mes " ";
		mes "2. ^FF0000" + GetGuildName(.@GID) + "^000000 公會的主人是";
		mes "　　^FF0000" + GetGuildMaster(.@GID) + "^000000,無論是誰";
		mes "　　對這件事情有意見者";
		mes " ";
		mes "請你舉起您的劍,提高自己的名譽吧";
		close;
	}

OnRecvCastlesc01:
	FlagEmblem GetCastleData("schg_cas01",1);
	end;
}

sch_gld,297,90,0	duplicate(Sc01_Flag)	喜民#flag_sc01_2	722